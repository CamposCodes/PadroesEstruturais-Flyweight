<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sistema Caf√© - Flyweight Pattern</title>
</head>
<body>
<div class="container">
<h1>‚òï Sistema Caf√©/Bar - Flyweight Pattern</h1>

<!-- Estat√≠sticas -->
<div class="stats" role="region" aria-label="Estat√≠sticas do Flyweight">
  <div class="stat" id="flyweights" aria-live="polite">
    <div class="stat-icon">‚öôÔ∏è</div>
    <div class="stat-content">
      <div class="stat-number">0</div>
      <div class="stat-label">Flyweights Criados</div>
    </div>
  </div>

  <div class="stat" id="orderItems" aria-live="polite">
    <div class="stat-icon">üßæ</div>
    <div class="stat-content">
      <div class="stat-number">0</div>
      <div class="stat-label">Itens de Pedido</div>
    </div>
  </div>

  <div class="stat" id="memSaved" aria-live="polite">
    <div class="stat-icon">üíæ</div>
    <div class="stat-content">
      <div class="stat-number">0 KB</div>
      <div class="stat-label">Mem√≥ria Economizada</div>
    </div>
  </div>
</div>

<!-- Controles -->
<div class="card">
<h2>Controles de Simula√ß√£o</h2>
<div class="buttons">
  <button class="add" onclick="addRandomOrder()">+ Adicionar Pedido</button>
  <button class="bulk-10" onclick="addBulkOrders(10)">+ 10 Pedidos</button>
  <button class="bulk-100" onclick="addBulkOrders(100)">+ 100 Pedidos</button>
  <button class="clear" onclick="clearOrders()">Limpar Tudo</button>
</div>
</div>

<!-- Lista de pedidos -->
<div class="card orders" id="ordersList">
<h2>Pedidos Recentes (<span id="orderCount">0</span>)</h2>
<div id="ordersContainer">Nenhum pedido ainda. Clique em "Adicionar Pedido".</div>
</div>

<!-- Explica√ß√£o -->
<div class="card">
<h3>üéì Como Funciona o Flyweight</h3>
<ul>
<li><strong>Estado Intr√≠nseco:</strong> Dados compartilhados (nome, categoria, pre√ßo-base, ingredientes)</li>
<li><strong>Estado Extr√≠nseco:</strong> Dados √∫nicos (quantidade, mesa, customiza√ß√µes, hor√°rio)</li>
<li><strong>Economia:</strong> 100 pedidos de "Espresso" = 1 objeto Flyweight + 100 refer√™ncias leves</li>
<li><strong>Factory:</strong> Garante que cada produto √∫nico seja criado apenas uma vez</li>
</ul>
</div>
</div>

<script>
const ordersContainer = document.getElementById('ordersContainer');
const orderCountSpan = document.getElementById('orderCount');
const flyweightsDiv = document.getElementById('flyweights');
const orderItemsDiv = document.getElementById('orderItems');
const memSavedDiv = document.getElementById('memSaved');

let orders = [];
let flyweightsCount = 0;
let totalOrders = 0;

const factory = {
  products: new Map(),
  getProduct(id, name, category, basePrice, prepTime, ingredients, icon) {
    if (!this.products.has(id)) {
      this.products.set(id, {
        id, name, category, basePrice, prepTime, ingredients, icon
      });
      flyweightsCount++;
    }
    return this.products.get(id);
  }
};

function addRandomOrder() {
  const tables = [1, 2, 3, 4, 5, 6, 7, 8];
  const products = [
    { id: 'esp', name: 'Espresso', category: 'Caf√©', price: 4.50, time:2, ing:['Caf√©'], icon:'‚òï' },
    { id: 'cap', name: 'Cappuccino', category: 'Caf√©', price: 6.00, time:3, ing:['Caf√©', 'Leite', 'Espuma'], icon:'‚òï' },
    { id: 'lat', name: 'Latte', category: 'Caf√©', price: 6.50, time:3, ing:['Caf√©', 'Leite'], icon:'‚òï' },
    { id: 'moc', name: 'Mocha', category: 'Caf√©', price: 7.50, time:4, ing:['Caf√©', 'Chocolate', 'Leite'], icon:'‚òï' },
    { id: 'ice', name: 'Sorvete', category: 'Sobremesa', price: 8.00, time:1, ing:['Creme', 'A√ß√∫car'], icon:'üç®' },
    { id: 'san', name: 'Sandu√≠che', category: 'Comida', price: 12.00, time:5, ing:['P√£o', 'Queijo', 'Presunto'], icon:'ü•™' }
  ];

  const customizationsOptions = [
    { id: 'extra-shot', name: 'Shot Extra', price: 2.00 },
    { id: 'soy-milk', name: 'Leite de Soja', price: 1.50 },
    { id: 'whipped-cream', name: 'Chantilly', price: 1.00 }
  ];

  const randomProduct = products[Math.floor(Math.random() * products.length)];
  const randomTable = tables[Math.floor(Math.random() * tables.length)];
  const quantity = Math.floor(Math.random() * 3) +1;

  // Customiza√ß√µes aleat√≥rias
  const customizations = [];
  if (Math.random() > 0.5) {
    customizations.push( customizationsOptions[Math.floor(Math.random() * customizationsOptions.length)] );
  }

  // Obt√©m ou cria o produto (Flyweight)
  const product = factory.getProduct(
    randomProduct.id,
    randomProduct.name,
    randomProduct.category,
    randomProduct.price,
    randomProduct.time,
    randomProduct.ing,
    randomProduct.icon
  );

  const timestamp = new Date().toLocaleTimeString();

  const order = {
    product,
    quantity,
    customizations,
    tableNumber: randomTable,
    timestamp,
    getTotalPrice() {
      let total = this.product.basePrice;
      this.customizations.forEach(c => total += c.price);
      return total * this.quantity;
    }
  };

  orders.push(order);
  totalOrders++;
  updateDisplay();
  updateStats();
}

// Adiciona m√∫ltiplos pedidos
function addBulkOrders(count) {
  for(let i=0; i<count; i++) addRandomOrder();
}

function updateDisplay() {
  document.getElementById('orderCount').innerText = orders.length;
  ordersContainer.innerHTML = '';

  if (orders.length === 0) {
    ordersContainer.innerHTML = 'Nenhum pedido ainda. Clique em "Adicionar Pedido".';
    return;
  }
  const recent = orders.slice(-50).reverse();
  recent.forEach((order, idx) => {
    const div = document.createElement('div');
    div.className = 'order';

    // √çcone
    const iconSpan = document.createElement('span');
    iconSpan.className = 'icon';
    iconSpan.textContent = order.product.icon;

    // Detalhes
    const detailsDiv = document.createElement('div');
    detailsDiv.className = 'order-details';

    const desc = document.createElement('div');
    desc.className = 'info';
    desc.innerHTML = `<strong>${order.quantity}x ${order.product.name}</strong><br/>Mesa ${order.tableNumber} ‚Ä¢ ${order.product.category} ‚Ä¢ ${order.timestamp}`;
    if (order.customizations.length > 0) {
      const extras = order.customizations.map(c => c.name).join(', ');
      desc.innerHTML += `<br/><small>+ ${extras}</small>`;
    }

    // Pre√ßo
    const priceDiv = document.createElement('div');
    priceDiv.className = 'price';
    priceDiv.innerHTML = `<div class="value">R$ ${order.getTotalPrice().toFixed(2)}</div>
                <div class="time">${order.product.prepTime * order.quantity} min</div>`;

    detailsDiv.appendChild(desc);
    div.appendChild(iconSpan);
    div.appendChild(detailsDiv);
    div.appendChild(priceDiv);
    ordersContainer.appendChild(div);
  });
}

function updateStats() {
  // Mem√≥ria economizada estimada
  const ordersCount = orders.length;
  const bytesPerProduct = 200; // estimativa
  const bytesPerRef = 8;
  const withoutFlyweight = ordersCount * bytesPerProduct;
  const withFlyweight = (flyweightsCount * bytesPerProduct) + (ordersCount * bytesPerRef);
  const savedKB = ((withoutFlyweight - withFlyweight)/1024).toFixed(2);

  // Atualiza n√∫meros dentro dos cart√µes (preserva √≠cones e labels)
  const setStat = (el, value, suffix = '') => {
    const num = el.querySelector('.stat-number');
    if (num) num.innerText = value + (suffix || '');
  };
  setStat(flyweightsDiv, flyweightsCount);
  setStat(orderItemsDiv, ordersCount);
  setStat(memSavedDiv, savedKB, ' KB');
}

function clearOrders() {
  orders = [];
  updateDisplay();
  updateStats();
}
</script>
<style>
  :root{
    --bg:#f6f8fa;
    --surface:#ffffff;
    --muted:#6a737d;
    --border:#e1e4e8;
    --accent:#0366d6;
    --success:#28a745;
    --shadow: 0 1px 2px rgba(27,31,35,0.04), 0 8px 24px rgba(27,31,35,0.08);
  }
  html,body{height:100%;}
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: var(--bg);
    color: #24292e;
    -webkit-font-smoothing:antialiased;
  }
  .container {
    max-width: 1100px;
    margin: 32px auto;
    padding: 20px;
  }
  h1 {
    font-size: 1.6rem;
    margin: 0 0 8px 0;
    color: #0b2d4a;
  }
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    box-shadow: var(--shadow);
    padding: 18px;
    margin-bottom: 18px;
  }
  /* Estat√≠sticas em grid responsivo */
  .stats{
    display: grid;
    grid-template-columns: repeat(3, minmax(0,1fr));
    gap: 12px;
    margin-bottom: 14px;
  }
  .stat{
    display:flex;
    gap:12px;
    align-items:center;
    padding:14px;
    border-radius:10px;
    background: linear-gradient(180deg, #ffffff, #fbfdff);
    border: 1px solid var(--border);
  }
  .stat-icon{
    width:56px;
    height:56px;
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:1.4rem;
    background: rgba(3,102,214,0.08);
    color: var(--accent);
    flex-shrink:0;
  }
  .stat-content{display:flex;flex-direction:column}
  .stat-number{font-size:1.4rem;font-weight:700;color:#092a4a}
  .stat-label{font-size:0.85rem;color:var(--muted);margin-top:4px}

  .buttons{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  button{padding:8px 12px;border-radius:6px;border:1px solid var(--border);background:var(--surface);cursor:pointer;font-weight:600}
  button.add{background:var(--accent);color:#fff;border-color:transparent}
  button.bulk-10{background:#2ea44f;color:#fff}
  button.bulk-100{background:#bf3b44;color:#fff}
  button.clear{background:transparent}
  button:hover{opacity:0.95}

  .orders{max-height:360px;overflow-y:auto}
  .order{display:flex;gap:12px;align-items:center;padding:12px;border-radius:8px;border:1px solid var(--border);background:linear-gradient(180deg,#fff,#fcfeff);margin-top:10px}
  .order .icon{width:48px;height:48px;border-radius:8px;background:linear-gradient(180deg,#f1f7fd,#fff);display:flex;align-items:center;justify-content:center;font-size:1.4rem}
  .order .order-details{flex:1}
  .order .order-details .info{display:flex;flex-direction:column}
  .order .order-details .info strong{font-size:1rem;color:#092a4a}
  .order .price{min-width:110px;text-align:right}
  .order .price .value{font-weight:700;color:var(--success);font-size:1.05rem}

  h3{margin-top:18px}
  ul{padding-left:18px}

  /* Responsividade */
  @media (max-width:800px){
    .stats{grid-template-columns:1fr}
    .order{flex-direction:column;align-items:flex-start}
    .order .price{text-align:left;width:100%}
  }
</style>
</body>
</html>
